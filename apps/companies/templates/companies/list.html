{% extends 'base.html' %}

{% block title %}기업 조회 - 장기 투자 분석{% endblock %}

{% block content %}
<div x-data="companyList()" class="row">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-body p-4">
                <h2 class="card-title mb-4">
                    <i class="bi bi-building me-2"></i>기업 재무 데이터 조회
                </h2>
                <p class="text-muted mb-4">
                    기업번호(8자리) 또는 종목코드(6자리)를 입력하세요.
                </p>

                <div class="mb-3">
                    <label for="corpCodeInput" class="form-label">기업번호 또는 종목코드</label>
                    <input type="text" id="corpCodeInput" x-model="corpCode" 
                        @keyup.enter="goToCompanyDetail()"
                        class="form-control" placeholder="예: 00126380 또는 005930"
                        style="font-family: monospace;">
                    <div class="form-text">
                        <i class="bi bi-info-circle me-1"></i>
                        엔터키를 누르거나 조회 버튼을 클릭하면 상세 페이지로 이동합니다.
                    </div>
                </div>

                <button type="button" class="btn btn-primary btn-lg w-100" @click="goToCompanyDetail()"
                    :disabled="loading">
                    <span x-show="!loading">
                        <i class="bi bi-search me-2"></i>조회
                    </span>
                    <span x-show="loading" class="loading-spinner me-2"></span>
                    <span x-show="loading">조회 중...</span>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    function companyList() {
        return {
            corpCode: '',
            loading: false,

            goToCompanyDetail() {
                const code = this.corpCode.trim();
                
                if (!code) {
                    alert('기업번호 또는 종목코드를 입력해주세요.');
                    return;
                }

                // 입력값이 숫자만 있는지 확인
                if (!/^\d+$/.test(code)) {
                    alert('기업번호 또는 종목코드는 숫자만 입력할 수 있습니다.');
                    return;
                }

                // 기업번호(8자리) 또는 종목코드(6자리) 확인
                if (code.length === 8) {
                    // 기업번호로 바로 이동
                    window.location.href = '/companies/' + code + '/';
                } else if (code.length === 6) {
                    // 종목코드는 기업번호로 변환 후 이동
                    // 일단 입력한 값을 그대로 사용 (백엔드에서 변환 처리)
                    window.location.href = '/companies/' + code + '/';
                } else {
                    alert('기업번호는 8자리, 종목코드는 6자리 숫자입니다.');
                }
            }
        }
    }
</script>
{% endblock %}