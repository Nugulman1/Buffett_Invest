# 코드 구조 요약

## 프로젝트 개요
장기 투자 필터링 프로그램 - DART와 ECOS API를 활용한 재무 데이터 수집 및 분석 시스템

## 기술 스택
- **프레임워크**: Django 6.0
- **API**: Django REST Framework
- **언어**: Python 3.13
- **의존성 관리**: requirements.txt
- **환경 변수**: python-dotenv (.env 파일)

## 프로젝트 구조

```
Long_Term_Investing/
├── apps/                    # 애플리케이션 모듈
│   ├── dart/                # DART API 관련
│   │   ├── client.py        # DART API 클라이언트
│   │   ├── views.py         # DART API 뷰
│   │   ├── urls.py          # DART URL 라우팅
│   │   └── apps.py          # DART 앱 설정
│   ├── ecos/                # ECOS API 관련
│   │   ├── client.py        # ECOS API 클라이언트
│   │   ├── views.py         # ECOS API 뷰
│   │   ├── urls.py          # ECOS URL 라우팅
│   │   └── apps.py          # ECOS 앱 설정
│   ├── service/             # 데이터 수집 서비스 레이어
│   │   ├── orchestrator.py  # 데이터 수집 오케스트레이터
│   │   ├── dart.py          # DART 데이터 수집 서비스
│   │   └── ecos.py          # ECOS 데이터 수집 서비스
│   └── models.py            # 데이터 모델 (공통)
├── config/                  # Django 프로젝트 설정
│   ├── settings.py          # 프로젝트 설정
│   ├── urls.py              # 메인 URL 라우팅
│   └── wsgi.py              # WSGI 설정
├── docs/                    # 문서
├── indicators_mappings.json # 재무제표 계정명 매핑 테이블
├── manage.py                # Django 관리 스크립트
├── requirements.txt         # Python 패키지 의존성
└── .env                     # 환경 변수 (API 키 등)

```

## 주요 모듈 설명

### 1. 데이터 모델 (`apps/models.py`)

#### `CompanyFinancialObject`
회사 재무제표 데이터를 저장하는 객체
- **회사 정보**: `company_name`, `business_type_code`, `business_type_name`, `corp_code`, `collection_year`
- **재무 지표**: `FCF`, `CFO`, `Net_Income`
- **비율 지표**: `ICR`, `ROIC`, `WACC`

#### `FinancialStatementData`
연도별 재무제표 데이터 (O(1) 조회용 인덱싱)
- **속성**: `year`, `reprt_code`, `fs_div`
- **인덱싱**: `account_index` - 계정명을 키로 하는 딕셔너리
- **메서드**: `get_account_value()` - 계정값 O(1) 조회

### 2. DART API 클라이언트 (`apps/dart/client.py`)

#### `DartClient`
DART OpenDART API 클라이언트
- **BASE_URL**: `https://opendart.fss.or.kr/api`
- **주요 메서드**:
  - `_make_request()`: 공통 API 요청 메서드 (JSON/바이너리 지원)
  - `get_company_info()`: 기업 정보 조회 (corp_code 기반)
  - `get_company_basic_info()`: 종목코드로 기업 기본 정보 조회 (corp_name, corp_code, industry_code)
  - `get_company_by_stock_code()`: 종목코드로 전체 기업 정보 조회
  - `_get_corp_code_by_stock_code()`: 종목코드로 기업 고유번호 조회 (XML 파일 파싱)
  - `get_financial_statement()`: 재무제표 조회 (BS, IS, CF 포함)
  - `get_report_list()`: 공시보고서 목록 조회
  - `download_xbrl()`: XBRL 원본 파일 다운로드

### 3. ECOS API 클라이언트 (`apps/ecos/client.py`)

#### `EcosClient`
ECOS 한국은행 경제통계시스템 API 클라이언트
- **BASE_URL**: `https://ecos.bok.or.kr/api`
- **주요 메서드**:
  - `_make_request()`: 공통 API 요청 메서드 (주기별 지원)
  - `get_bond_yield_5y()`: 국채 5년 수익률 조회 (월별, 이전 달 자동 조회)

### 4. 데이터 수집 서비스 (`apps/service/`)

#### `EcosDataService` (`ecos.py`)
- `collect_bond_yield_5y()`: 국채 5년 수익률 수집

#### `DartDataService` (`dart.py`)
- `_get_recent_years()`: 최근 N년 연도 자동 계산 (연간보고서 발행 시점 고려)
- `collect_financial_data()`: 최근 5년 연간 보고서 재무제표 데이터 수집 (구현 완료)
  - 연결재무제표(CFS) 우선, 없으면 별도재무제표(OFS) 사용
  - 각 연도별 `FinancialStatementData` 객체 생성 및 반환

#### `DataOrchestrator` (`orchestrator.py`)
- `collect_company_data()`: 회사 데이터 통합 수집 (구현 예정)

## API 엔드포인트

### DART
- `GET /api/dart/company/<corp_code>/` - 기업 정보 조회

### ECOS
- (현재 테스트 코드 제거됨, 추후 추가 예정)

## 설정 파일

### `config/settings.py`
- **INSTALLED_APPS**: `rest_framework`, `apps.dart`, `apps.ecos`
- **API 키**: `.env` 파일에서 `DART_API_KEY`, `ECOS_API_KEY` 로드
- **데이터베이스**: SQLite (현재)

### `.env` 파일 (필수)
```
DART_API_KEY=your_dart_api_key
ECOS_API_KEY=your_ecos_api_key
SECRET_KEY=your_secret_key
DEBUG=True
```

## 데이터 흐름

1. **데이터 수집**: `DartClient` / `EcosClient` → API 호출
2. **서비스 레이어**: `DartDataService` / `EcosDataService` → 데이터 가공
3. **오케스트레이터**: `DataOrchestrator` → 통합 수집 및 조율
4. **모델 객체**: `CompanyFinancialObject` / `FinancialStatementData` → 데이터 저장
5. **API 응답**: Django REST Framework → JSON 응답

## 주요 특징

- **O(1) 조회**: `FinancialStatementData`에서 계정명으로 즉시 조회 가능
- **자동 날짜 처리**: ECOS API에서 이전 달 데이터 자동 조회
- **모듈화**: DART/ECOS 분리, 서비스 레이어 분리
- **확장성**: 새로운 데이터 소스 추가 용이

