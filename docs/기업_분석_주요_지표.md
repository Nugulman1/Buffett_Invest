# 기업 분석 주요 지표 정리

프로그램에서 기업 분석·필터링에 사용하는 주요 지표를 정리한 문서입니다.

---

## 1. 데이터 출처 요약

| 출처 | 용도 |
|------|------|
| **DART** | 매출액, 영업이익, 당기순이익, 자산/자본/부채, ROE(M211550), 판관비율 등 |
| **KRX** | 시가총액 (EV 계산용) |
| **ECOS** | 회사채 수익률 (WACC의 Rd 계산용) |
| **LLM 추출** | 비지배지분, 배당금 등 (사업보고서 from paste) |

---

## 2. 기본 지표 (연도별 저장)

`YearlyFinancialDataObject` / DB `YearlyFinancialData`에 저장되는 항목입니다.

### 2.1 DART API에서 수집·매핑

| 지표명 | 필드명 | 설명 |
|--------|--------|------|
| 매출액 | `revenue` | 손익계산서 (5년) |
| 영업이익 | `operating_income` | 손익계산서 (5년) |
| 당기순이익 | `net_income` | 손익계산서 (5년) |
| 자산총계 | `total_assets` | 재무상태표 |
| 자본총계 | `total_equity` | 재무상태표 |
| 유동자산 | `current_assets` | 다중회사 주요계정 |
| 비유동자산 | `noncurrent_assets` | 다중회사 주요계정 |
| 유동부채 | `current_liabilities` | 다중회사 주요계정 |
| 비유동부채 | `noncurrent_liabilities` | 다중회사 주요계정 |
| 부채총계 | `total_liabilities` | 다중회사 주요계정 |
| 자본금 | `capital_stock` | 다중회사 주요계정 |
| 이익잉여금 | `retained_earnings` | 다중회사 주요계정 |
| 법인세차감전순이익 | `profit_before_tax` | 다중회사 주요계정 |

### 2.2 DART 주요재무지표(fnlttCmpnyIndx)에서 수집

| 지표명 | 지표코드 | 필드명 | 비고 |
|--------|----------|--------|------|
| ROE | M211550 | `roe` | 퍼센트 값은 소수로 저장. 없으면 당기순이익/자본총계로 계산 |
| 판관비율 | (idx_nm 매칭) | `selling_admin_expense_ratio` | 판관비율 / 판매비와관리비율 |

### 2.3 프로그램에서 계산하여 채우는 지표

| 지표명 | 필드명 | 계산 공식 | 참고 |
|--------|--------|-----------|------|
| 영업이익률 | `operating_margin` | 영업이익 / 매출액 | 소수 저장 (예: 0.105 = 10.5%) |
| 부채비율 | `debt_ratio` | 자본총계 / 부채총계 | `total_liabilities` 필요 |

---

## 3. 계산 전용·확장 지표 (FCF/ROIC/WACC 등)

기업 조회·붙여넣기 재무제표 파싱 시 사용하며, **1차 수집 배치에서는 미수집**입니다.

### 3.1 계산에 필요한 입력 (DART/LLM 등)

| 항목 | 필드명 | 용도 |
|------|--------|------|
| 유형자산 취득 | `tangible_asset_acquisition` | FCF(CAPEX), ROIC 등 |
| 무형자산 취득 | `intangible_asset_acquisition` | FCF(CAPEX) |
| 영업활동현금흐름 | `cfo` | FCF |
| 자기자본 | `equity` | ROIC, WACC 분모 |
| 현금및현금성자산 | `cash_and_cash_equivalents` | ROIC, EV |
| 이자부채 | `interest_bearing_debt` | ROIC, WACC, EV |
| 이자비용 | `interest_expense` | WACC의 Rd |
| 비지배지분 | `noncontrolling_interest` | EV (LLM 추출 등) |

### 3.2 계산된 지표

| 지표명 | 필드명 | 공식 | 비고 |
|--------|--------|------|------|
| **CAGR** | (연도별 미저장) | (end/start)^(1/years) − 1 | 매출액 CAGR 필터에 사용 (현재 필터는 미적용) |
| **FCF** | `fcf` | CFO − \|유형자산취득 + 무형자산취득\| | 자유현금흐름 |
| **ROIC** | `roic` | (영업이익×(1−세율)) / (자기자본+이자부채−현금) | 소수 저장, 2차 필터 사용 |
| **WACC** | `wacc` | (E/(E+D))×Re + (D/(E+D))×Rd×(1−세율) | 소수 저장, 2차 필터 사용 |
| **IC** | `invested_capital` | 자기자본 + 이자부채 − 현금 | ROIC 분모와 동일 |
| **EV** | `ev` | 시가총액 + 이자부채 − (현금×70%) + 비지배지분 | KRX 시가총액 사용 |
| **ICR** | `icr` | 영업이익 / 금융비용 | 이자보상비율, 현재 미사용 |
| 배당성향 | `dividend_payout_ratio` | 배당금 / FCF | 기업 조회 시 계산 |

### 3.3 계산 시 사용하는 설정값

- **법인세율**: `config.settings.CALCULATOR_DEFAULTS['TAX_RATE']` (기본 25%)
- **주주기대수익률(MRP)**: `CALCULATOR_DEFAULTS['EQUITY_RISK_PREMIUM']` (기본 10%)
- **회사채 수익률**: ECOS 등에서 조회 후 WACC의 Rd로 사용

---

## 4. 1차 필터에서 사용하는 지표

`apps/service/filter.py`의 `CompanyFilter.apply_all_filters`에서 적용합니다.  
기준 기간: **최근 5년** (5년 미만이면 수집된 연도만 사용).

| 필터 | 사용 지표 | 통과 조건 |
|------|-----------|-----------|
| 영업이익 필터 | `operating_income` | 최근 5년 중 영업이익 ≤ 0인 연도 **≤ 1회** |
| 당기순이익 필터 | `net_income` | 최근 5년 당기순이익 **합계 > 0** |
| 매출액 CAGR 필터 | `revenue` → CAGR | 매출액 CAGR **≥ 10%** (※현재 **미적용**, 통과로 고정) |
| 영업이익률 필터 | `operating_margin` | 최근 5년 **평균** 영업이익률 **≥ 10%** |
| ROE 필터 | `roe`, `total_assets`, `total_equity` | 규모별 **평균 ROE** 임계값 이상 (아래 표 참고) |

### ROE 필터 규모별 임계값

- **대기업** (총자산 ≥ 10조): 평균 ROE ≥ **8%**
- **중견기업** (5천억 ≤ 총자산 < 10조): 평균 ROE ≥ **10%**
- **중소기업** (총자산 < 5천억): 평균 ROE ≥ **12%**

(총자산은 **최신 연도** 기준, `apps/utils/classify.py`의 `classify_company_size` 사용)

---

## 5. 2차 필터에서 사용하는 지표

- **조건**: 최근 3년 **평균 ROIC** − 최근 3년 **평균 WACC** ≥ `SECOND_FILTER_ROIC_WACC_SPREAD`
- **기본값**: `0.02` (2%p 이상이면 통과)
- **설정**: `config/settings.py` → `SECOND_FILTER_ROIC_WACC_SPREAD` (환경변수 `SECOND_FILTER_ROIC_WACC_SPREAD`로 override 가능)
- **데이터**: DB `YearlyFinancialData`의 해당 기업 최근 3년 `roic`, `wacc` 사용

---

## 6. 지표별 코드 위치 요약

| 구분 | 파일 |
|------|------|
| 1차 필터 조건 | `apps/service/filter.py` |
| CAGR/영업이익률/부채비율/FCF/ROIC/WACC/EV/IC/ICR | `apps/service/calculator.py` |
| 연도별 데이터 모델(필드 정의) | `apps/models.py` → `YearlyFinancialDataObject`, `CompanyFinancialObject` |
| 기업 규모 분류 | `apps/utils/classify.py` → `classify_company_size` |
| 계산 기본값(세율, MRP) | `config/settings.py` → `CALCULATOR_DEFAULTS` |
| 2차 필터 임계값 | `config/settings.py` → `SECOND_FILTER_ROIC_WACC_SPREAD` |
| DART 계정↔필드 매핑 | `indicators_mappings.json` |

---

## 7. 참고사항

- **매출액 CAGR 필터**: 1차 필터에서 정의되어 있으나 `apply_all_filters` 내에서 주석 처리되어 있으며, 현재는 `filter_revenue_cagr = True`로 고정되어 **미적용** 상태입니다. (`docs/TODO.md` 참고)
- **ROE**: DART 지표 M211550 우선 사용, 없으면 당기순이익/자본총계로 계산합니다. (`apps/service/orchestrator.py` → `_fill_roe_from_indicators`)
- **영업이익률**: 기본 재무 API에는 없어, 매출액·영업이익으로 프로그램에서 계산합니다.
